<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>update User Details</title>
    <style>
    	#addresses table {
	        border-collapse: collapse;
	    }
	    
	    #addresses th, #addresses td {
	        text-align: left;
	        padding: 8px;
	        border: 1px solid black;
	    }
	    
	    #addresses th {
	        background-color: #dddddd;
	    }
	    #addresses{
			margin-top: 50px;
		}
        #userDetails{
		  margin-left: 50px;
		  margin-top: 50px;
		}
		ul {
		  list-style-type: none;
		  margin: 0;
		  padding: 0 0 0 45%;
		  overflow: hidden;
		  background-color: #f3f3f3;
		}
		li {
		  float: left;
		}
		li a {
		  display: block;
		  color: black;
		  text-align: center;
		  padding: 14px 16px;
		  text-decoration: none;
		}
		li a:hover {
		  background-color: #ddd;
		}
    </style>
</head>
<body>
	<div th:include="fragments/header :: header"></div>
	<div id="userDetails">
	<div>
	    <form action="" th:method="PUT">
	    <table>
	    	<thead>
		        <tr>
	                <th colspan="2"><h1>Update Address Form</h1></th>
	            </tr>
	       	</thead>
	        <tbody>
	        		<tr>
	                    <td><label for="name">Name:</label></td>
	                    <td><input type="text" name="name" th:value="${user.name}"></td>
	                </tr>
	                <tr>
	                    <td><label for="email">Email:</label></td>
	                    <td><input type="email" name="email" th:value="${user.email}"></td>
	                </tr>
	                <tr/>
	                <tr/>
	                <tr>
	                    <td colspan="2" ><button type="submit">Update User</button></td>
	                </tr>
	        </tbody>
	    </table>
    	</form>
    </div>
    <div id="addresses">
    	<h1>Address List</h1>
	    <table>
	        <tr>
	        	<th>id</th>
	            <th>Street</th>
	            <th>City</th>
	            <th></th>
	            <th></th>
	        </tr>
	        <tr th:each="address : ${user.addresses}">
	        	<td th:text="${address.id}"></td>
	            <td th:text="${address.street}"></td>
	            <td th:text="${address.city}"></td>
	            <td><a th:href="@{/users/{userId}/address/{addressId} (userId=${user.id}, addressId=${address.id})}">Edit</a></td>					            
	            <td>
				    <button type="button" th:onclick="deleteAddress([[${user.id}]], [[${address.id}]])">Delete</button>
				
					<!-- AJAX function to delete user -->
					<script>
					    function deleteAddress(userId, addressId) {
					        if (confirm("Are you sure you want to delete this address?")) {
					            fetch("address/"+addressId, {
					                method: 'DELETE'
					            })
					            .then(response => {
					                if (response.ok) {
					                	 location.reload();
					                    console.log('Address deleted successfully');
					                } else {
					                    console.log('Error deleting address');
					                }
					            })
					            .catch(error => {
					                console.log('Error deleting address');
					            });
					        }
					    }
					</script>
				</td>
	        </tr>
	    </table>
	    <br>
    	<a th:href="@{/users/{userId}/address (userId=${user.id})}">Add New Address</a>
    </div>
    </div>
</body>
</html>
